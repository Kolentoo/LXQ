/*! uzai - v0.1.11 - 2015-11 *//*! 共用api
* jsonchou
* v: 1.1
* d: 2014-5-14
*/
function shortcutMenu(){$(".shortcut-focus a").on(_tap,function(){var a=$(this);return a.hasClass("open")?(a.removeClass("open"),a.addClass("close"),$(".plate").removeClass("open"),$(".plate").addClass("close"),$("#shortcut-mask").hide()):(a.removeClass("close"),a.addClass("open"),$(".plate").removeClass("close"),$(".plate").addClass("open"),$("#shortcut-mask").show()),!1})}function closePlate(){$(document).on("click touchend",function(a){var b=$(a.target),c=$("#shortcut-menu");return 0==b.closest("#shortcut-menu").length&&c.find(".plate").hasClass("open")?($(".shortcut-focus a").click(),!1):void 0})}function backAction(){var a=decodeURIComponent(document.referrer);$(".fn-header .back").on("click",function(){a.indexOf(".uzai.com")<=-1?location.href=_uzm.domain.m:history.go(-1)})}function userLoginStatus(){var a=$("#login-status");a.html(_uzm.cookie.get("user")?"<a href='"+_uzm.domain.u+"/mobile/order'>"+_uzm.user.userName+"</a><a href='"+_uzm.domain.u+"/mobile/logout'>退出</a>":"<a href='"+_uzm.domain.u+"/mobile/login'>登录</a><a href='"+_uzm.domain.u+"/mobile/reg'>注册</a>")}function topDownTip(){var a="hide",b=_uzm.cookie.get("uzmTopDownTip");a=b?"hide":"show",_uzm.mobile.isUC&&(a="hide"),_embed&&(a="hide");var c=document.location.href.replace("#","");c.indexOf("waptour")>-1&&(a="hide"),(c.indexOf("source=weixin")>-1||c.indexOf("source=pctour")>-1)&&(a=b?"hide":"show"),_embed&&(a="hide"),"hide"==a?$("#smartBanner").hide():$("#smartBanner").show(),$("#smartBanner .sb-close").on(_tap,function(){$(this);_uzm.cookie.set("uzmTopDownTip","true",7),$("#smartBanner").hide()})}function iosFixedBug(a,b){if(_uzm.mobile.isIpad||_uzm.mobile.isIphone){var c="."+a,d="."+b;null==$(c).get(0)&&(c="#"+a),null==$(d).get(0)&&(d="#"+b),null!=$(c).get(0)&&null!=$(c).get(0)&&$(document).on("focus",c,function(){$(d).hide()}).on("blur",c,function(){$(d).show()})}}function checkEmbed(){var a=document.location.href.toLowerCase();(a.indexOf("source=iphone")>-1||a.indexOf("source=ipad")>-1||a.indexOf("source=android")>-1||_uzm.mobile.isWeiXin)&&(_embed=!0)}function checkTerminal(){var a=document.location.href;(a.indexOf("source=iphone")>-1||a.indexOf("source=ipad")>-1||a.indexOf("source=android")>-1)&&(_terminal="mobileApp",_uzm.terminal.isIOS=a.indexOf("source=iphone")>-1||a.indexOf("source=ipad")>-1?!0:!1,_uzm.terminal.isAndroid=a.indexOf("source=android")>-1?!0:!1)}function handleHeaderFooter(){_embed?hideHF():showHF(),_uzm.mobile.isWeiXin&&hideHF()}function appWrapFixSource(a){if("mobileApp"===_terminal){var b=$("."+a);null==b.get(0)&&(b=$("#"+a));var c=document.location.href,d=_util.url.param(c,"source");if(null!=b.get(0)){var e=b.find("a[data-app]");e.each(function(){var a=$(this),b=a.attr("href").replace("#","");a.attr("href",b+(b.indexOf("?")>-1?"&":"?")+"source="+d)})}}}var _env="real",_host=document.location.host;(_host.indexOf("localhost:")>-1||_host.indexOf("127.0.0.1")>-1||_host.indexOf("10.1.")>-1)&&(_env="dev");var _domain="uzai.com",_ua=navigator.userAgent.toLowerCase(),_tap="tap",_terminal="webApp",_uzm=window._uzm||{},_atom=window._atom||{},_util=window._util||{},_embed=!1;_atom={pop:{}},_util={url:{},user:{},array:{},cdn:{}},_util.url.param=function(a,b){var c=a.toLowerCase();if(c){c=c.replace(/#/g,"");var d=c.indexOf("?");c=c.substr(d+1);for(var e=c.split("&"),f=0;f<e.length;f++){var g=e[f],h=g.split("=")[0],i=g.split("=")[1];if(h==b.toLowerCase())return i}}return""},_util.user.param=function(a){var b=_uzm.cookie.get("user");if(b)for(var c=b.split("&"),d=0;d<c.length;d++){var e=c[d],f=e.split("=")[0],g=e.split("=")[1];if(f==a)return g}return""},_util.array.unique=function(a){if(a.length>0){for(var b=[],c={},d=0;d<a.length;d++)c[a[d]]||(b.push(a[d]),c[a[d]]=1);return b}},_util.cdn.clear=function(a){for(var b=$("head").find("link[rel=stylesheet]"),c=void 0===a?Math.random():a,d=0;d<b.length;d++){var e=b[d],f=e.getAttribute("href").split("?")[0];e.setAttribute("href",f+"?v="+c)}},_atom.pop.closetoast=function(){$(".fn-toast").css({opacity:"0"}),$(".fn-toast").remove()},_atom.pop.closecup=function(){$(".fn-cup").css({opacity:"0"}),$(".fn-cup").remove()},_uzm={env:_env,cookie:{},array:{},user:{},regex:{},pop:{},mask:{},cooperate:{},mobile:{},ui:{},pkg:{},terminal:{}},_uzm.regex={qq:"^[1-9]*[1-9][0-9]*$",mobile:"^13[0-9]{9}|15[012356789][0-9]{8}|18[02356789][0-9]{8}|147[0-9]{8}$"},_uzm.mobile={isForce:!1,isIpad:"ipad"==_ua.match(/ipad/i),isIphone:"iphone os"==_ua.match(/iphone os/i),isAndroid:"android"==_ua.match(/android/i),isWC:"windows ce"==_ua.match(/windows ce/i),isWM:"windows mobile"==_ua.match(/windows mobile/i),isWP:"windows phone"==_ua.match(/windows phone/i),isWebOS:"webos"==_ua.match(/webos/i),isWeiXin:"micromessenger"==_ua.match(/micromessenger/i),isBlackberry:"blackberry"==_ua.match(/blackberry/i),isUC:"ucweb"==_ua.match(/ucweb/i)||"ucbrowser"==_ua.match(/ucbrowser/i),isPC:function(){return!(this.isIpad||this.isIphone||this.isAndroid||this.isWC||this.isWM||this.isWP||this.isWebOS||this.isBlackberry||this.isUC||this.isWeiXin)}},_uzm.terminal={isIOS:{},isAndroid:{}},_uzm.domain={m:"http://m.uzai.com",u:"https://u.uzai.com",cdn:"//r.uzaicdn.com",api:"http://m.uzai.com",buy:"https://buy.uzai.com"},_uzm.ui={loader:_uzm.domain.cdn+"/content/m/images/common/gray.gif"},_uzm.pkg={iphone:"https://itunes.apple.com/cn/app/you-zai-lu-you/id519653239?mt=8",ipad:"https://itunes.apple.com/cn/app/you-zai-lu-you-hd/id588951281?mt=8",android:_uzm.domain.cdn+"/uzaitravel.apk"},_uzm.cookie.set=function(a,b,c){c=void 0===c?7:c;try{b=encodeURIComponent(b)}catch(d){b=escape(b)}$.fn.cookie(a,b,{expires:c,path:"/",domain:"real"===_uzm.env?_domain:""})},_uzm.cookie.get=function(a){var b=$.fn.cookie(a);if(b){try{v=decodeURIComponent(b)}catch(c){v=unescape(b)}return v}return null},_uzm.cookie.del=function(a){var b=_uzm.cookie.get(a);b&&$.fn.cookie(a,"",{expires:-1,path:"/",domain:"real"===_uzm.env?_domain:""})},_uzm.user={userid:_util.user.param("userid"),userName:_util.user.param("userName"),nickname:_util.user.param("nickname"),realname:_util.user.param("realname"),Email:_util.user.param("Email"),Mobile:_util.user.param("Mobile"),islogin:_util.user.param("islogin"),userGrade:_util.user.param("userGrade"),headUrl:_util.user.param("headUrl")};var showHF=function(){$(".fn-header").show(),$(".fn-footer").show(),$("#shortcut-menu").show()},hideHF=function(){$(".fn-header").hide(),$(".fn-footer").hide(),$("#shortcut-menu").hide(),$(".fn-header").next("section").css({"margin-top":"0"})};_uzm.init=function(){_tap="click",checkEmbed(),checkTerminal(),handleHeaderFooter(),_uzm.cooperate.source()},_uzm.pop.toast=function(a,b){$(".fn-toast").remove(),$("body").append("<div class='fn-toast'>"+a+"</div>"),$(".fn-toast").css({opacity:"1"}),b=b||2e3,$(".fn-toast").on(_tap,function(){_atom.pop.closecup()}),setTimeout("_atom.pop.closetoast()",b)},_uzm.pop.cup=function(a,b){$(".fn-cup").remove(),$("body").append("<div class='fn-cup'>"+a+"</div>"),$(".fn-cup").css({opacity:"1"}),b=b||6e4,$(".fn-cup").on(_tap,function(){_atom.pop.closecup()}),setTimeout("_atom.pop.closecup()",b)},_uzm.mask={show:function(){$(".fn-mask").remove();var a={height:$("body").height(),display:"block"};$("body").append("<div class='fn-mask'></div>"),$(".fn-mask").css(a)},hide:function(){$(".fn-mask").remove()}},_uzm.cooperate.source=function(){var a=decodeURIComponent(document.referrer),b=decodeURIComponent(document.location.href.replace("#","").toLowerCase()),c="uzmURLRefer",d="uzmSource",e=_uzm.cookie.get(c);if(_embed)if(b.indexOf("source=iphone")>-1)_uzm.cookie.set(d,"iphone",1);else if(b.indexOf("source=ipad")>-1)_uzm.cookie.set(d,"ipad",1);else if(b.indexOf("source=android")>-1)_uzm.cookie.set(d,"android",1);else if(b.indexOf("source=metlife")>-1){var f=_util.url.param(b,"duid");_uzm.cookie.set(d,"metlife|"+f,1)}else b.indexOf("weixinhand")>-1?_uzm.cookie.set(d,"weixinhand",1):_uzm.cookie.set(d,"weixin",1);var g=_uzm.cookie.get(d);g&&("iphone"==g||"ipad"==g||"android"==g||g.indexOf("weixin")>-1)?hideHF():showHF(),a?e&&(e.indexOf("utm_source=")>-1||e.indexOf("utm_medium=")>-1)?(b.indexOf("utm_source=")>-1||b.indexOf("utm_medium=")>-1)&&_uzm.cookie.set(c,b,1):b.indexOf("utm_source=")>-1||b.indexOf("utm_medium=")>-1?_uzm.cookie.set(c,b,1):a.indexOf(".uzai.com")<=-1&&_uzm.cookie.set(c,a,1):e?(b.indexOf("utm_source=")>-1||b.indexOf("utm_medium=")>-1)&&_uzm.cookie.set(c,b,1):_uzm.cookie.set(c,b,1)},$(function(){_uzm.init(),shortcutMenu(),closePlate(),backAction(),userLoginStatus(),topDownTip()});