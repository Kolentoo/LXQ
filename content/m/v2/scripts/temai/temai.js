'use strict';var temaiexports={};temaiexports.init=function(){_util.file.load(_uzm.domain.cdnRandom()+'/content/m/v2/scripts/com/unveil.js',function(){window.unveil.init('j_temaiList')});temaiexports.initTourList();temaiexports.initSubmit();temaiexports.tip();temaiexports.userModify();var sBox=$('#j_temaiFocus');var len=sBox.find('a.box').length;if(sBox.get(0)&&len>1){_util.file.load(_uzm.domain.cdnRandom()+'/content/m/v2/scripts/com/slider.js',function(){window.slider.api('j_temaiFocus','j_temaiFocusWrap',5000,true)})}var sTab=$('#j_userTab');if(sTab.get(0)){_util.file.load(_uzm.domain.cdnRandom()+'/content/m/v2/scripts/com/tab.js',function(){window.tab.init('j_userTab')})}temaiexports.calendar();temaiexports.addUser();temaiexports.saveChooseTourList();temaiexports.submitOrder();temaiexports.math();temaiexports.saveRoute()};temaiexports.initSubmit=function(){var u=location.href.toLowerCase().replace('#','');var pid=_util.url.get('pid');var gdate=_util.url.get('gdate');var contactMan=window.unescape(_util.url.get('contactman'));var contactPhone=_util.url.get('contactphone');var fenshu=_util.url.get('fenshu');var renshu=_util.url.get('renshu');var ischina=_util.url.get('ischina');var tourids=_util.url.get('tourids');var sb=[];if(pid){$('#pid').val(pid)}if(gdate){$('#gdate').val(gdate)}if(fenshu){$('#j_fenshu').find('input').val(fenshu)}if(renshu){$('#j_renshu').find('input').val(renshu)}if(ischina){$('#ischina').val(ischina)}if(contactMan){$('#j_orderContact').find('input').eq(0).val(contactMan)}if(contactPhone){$('#j_orderContact').find('input').eq(1).val(contactPhone)}};temaiexports.initTourList=function(){var u=location.href.toLowerCase().replace('#','');var tourids=_util.url.get('tourids');if(tourids){var ids=tourids.split('-');var rds=$('#j_userTab').find('.users-list').find('li').find('.round');rds.each(function(){var oo=$(this);var oop=oo.parents('li');var ooa=oop.attr('data-id');var bIn=$.inArray(ooa,ids);if(bIn>-1){oo.addClass('on')}})}};temaiexports.saveChooseTourList=function(){var u=location.href.toLowerCase().replace('#','');var myCount=_util.url.get('renshu');$('#j_saveChooseList').on('click',function(){var ul=$('#j_userTab').find('.bd').find('.item').find('ul');var ss=ul.find('span.on');var sb=[];ss.each(function(){var oo=$(this);var oop=oo.parents('li');var oov=oop.attr('data-id');sb.push(oov)});if(sb.length==myCount){u=u.replace('touristlist','temaisubmit');var newUrl=_util.url.set('tourids',sb.join('-'));if(newUrl.indexOf('renshu')>-1){var tagr='renshu='+_util.url.get('renshu');if(tagr){newUrl=newUrl.replace(tagr,'renshu='+sb.length)}}location.href=newUrl}else{_uzm.pop.toast('\u8BF7\u9009\u62E9'+myCount+'\u4F4D\u65C5\u5BA2')}})};temaiexports.addUser=function(){var pop=function pop(obj,v){_uzm.pop.toast(v)};$('#personType').on('change',function(){var oo=$(this);var oov=oo.val();if(oov=='0'){$('#userPhone').parents('.clearfix').show()}else if(oov=='3'){$('#userPhone').parents('.clearfix').hide()}});$('#j_saveUser').click(function(){var url=location.href.toLowerCase();var id=0;if(url.indexOf('-')>-1){id=url.split('-')[1].split('.')[0]}var sb=[];var push=function push(obj,name){if(obj.val()){sb.push(name+'='+obj.val())}};var b=true;var usertype=$('input[name=usertype]');var userName=$('input[name=userName]');var personType=$('select[name=personType]');var userSex=$('select[name=userSex]');var userNational=$('input[name=userNational]');var userPaper=$('select[name=userPaper]');var userPaperID=$('input[name=userPaperID]');var userPaperUseTime=$('input[name=userPaperUseTime]');var userBirthTime=$('input[name=userBirthTime]');var userPhone=$('input[name=userPhone]');if(id){sb.push('tourid'+'='+id)}sb.push('usertype'+'='+usertype.val());if(!userName.val()){pop(userName,'\u8BF7\u8F93\u5165\u59D3\u540D');return false}else{push(userName,'userName')}var ptv=personType.val();var isc=$('#usertype').val();if(personType.val()){push(personType,'personType')}if(userSex.val()){push(userSex,'userSex')}if(!userNational.val()){if(ptv=='1'){pop(userNational,'\u8BF7\u8F93\u5165\u56FD\u7C4D');return false}}else{push(userNational,'userNational')}if(userPaper.val()){push(userPaper,'userPaper')}if(!userPaperID.val()){pop(userPaperID,'\u8BF7\u8F93\u5165\u8BC1\u4EF6\u53F7\u7801');return false}else{if(isc=='1'){if(userPaper.val()=='0'){var r=_uzm.regex.idcard;var isValid=new RegExp(r).test(userPaperID.val());if(!isValid){pop(userPaperID,'\u8BF7\u586B\u5199\u6B63\u786E\u7684\u8EAB\u4EFD\u8BC1\u53F7\u7801');return false}}}push(userPaperID,'userPaperID')}if(!userPaperUseTime.val()){pop(userPaperUseTime,'\u8BF7\u8F93\u5165\u8BC1\u4EF6\u6709\u6548\u671F');return false}else{push(userPaperUseTime,'userPaperUseTime')}if(!userBirthTime.val()){pop(userBirthTime,'\u8BF7\u8F93\u5165\u51FA\u751F\u65E5\u671F');return false}else{push(userBirthTime,'userBirthTime')}if(!userPhone.val()){if(ptv=='0'){pop(userPhone,'\u8BF7\u586B\u5199\u624B\u673A\u53F7');return false}else if(ptv=='3'){}}else{if(!_uzm.regexForm.mobile(userPhone.val())){pop(userPhone,'\u8BF7\u586B\u5199\u6B63\u786E\u7684\u624B\u673A\u53F7');return false}else{push(userPhone,'userPhone')}}var u='/TouristSubmit';$.ajax({url:u,type:'POST',data:sb.join('&'),success:function success(data){if(data=='1000'){_uzm.pop.toast('\u4FDD\u5B58\u6210\u529F');location.href=document.referrer}else{_uzm.pop.toast('\u4FDD\u5B58\u5931\u8D25')}}})})};temaiexports.calendar=function(){$('#j_txtTemaiDate').on('click',function(){var o=$(this);_uzm.mask.show();$('#j_calendarTemai').css({'margin-bottom':'0'});$('.fn-mask').on('click',function(){_uzm.mask.hide();$('#j_calendarTemai').css({'margin-bottom':'-325px'})})});$('#j_calendarTemai').on('click','div[id^=d]',function(){var o=$(this);var od=o.attr('datetime');$('#j_txtTemaiDate').val(od);var ourl=$('#temaisubmit').attr('href');var tag=_util.url.get(ourl,'gdate');var nurl=ourl.replace('gdate='+tag,'gdate='+od);$('#temaisubmit').attr('href',nurl);_uzm.mask.hide();$('#j_calendarTemai').css({'margin-bottom':'-325px'})})};temaiexports.math=function(){var box=$('#j_numControl');var fs=parseInt(box.find('b.fs').text(),10);var cn=parseInt($('#cutNum').val(),10);var txtFen=$('#j_fenshu').find('input');var txtRen=$('#j_renshu').find('input');var nFen=$('#j_fenshu');var nRen=$('#j_renshu');var conBox=$('#j_orderListUsers');var _unitUserEvent=function _unitUserEvent(){var conRen=parseInt(txtRen.val(),10);var conUl=conBox.find('ul');var sb=[];var u=location.href.toLowerCase().replace('#','');u=u.replace('temaisubmit','touristList');var url=_util.url.set('ischina',$('#j_isChina').val()||'0');var len=conUl.find('li').length;if(len<=0){for(var i=0;i<conRen;i++){sb.push('<li class=\'clearfix\'>');sb.push('<a class=\'block clearfix\' href=\'#\'>');sb.push('<span class=\'fl f999 g4 f14\'>\u7B2C<span>'+(i+1)+'</span>\u4F4D\u65C5\u5BA2</span>');sb.push('<div class=\'fl g6\'>');sb.push('<p class=\'p1 f16\'></p>');sb.push('<p class=\'p2 f12 f999\'></p>');sb.push('</div>');sb.push('<span class=\'arrow\'></span>');sb.push('</a>');sb.push('</li>')}conUl.html(sb.join(''))}};_unitUserEvent();var _unitPriceEvent=function _unitPriceEvent(){var pbox=$('.order-summary').find('.info').find('.block').find('.f18');var punit=parseInt(pbox.attr('data-unitprice'),10);var fenshu=parseInt($('#buynum').val(),10);pbox.text(punit*fenshu)};_unitPriceEvent();var _unitUserEventExt=function _unitUserEventExt(renshu){renshu=parseInt(renshu,10)||1;var conUl=conBox.find('ul');var len=conUl.find('li').length;var renShu=parseInt($('#j_renshu').find('input').val(),10);if(renshu>len){var cha=renshu-len;var sb=[];for(var i=0;i<cha;i++){sb.push('<li class=\'clearfix\'>');sb.push('<a class=\'block clearfix\' href=\'#\'>');sb.push('<span class=\'fl f999 g4 f14\'>\u7B2C<span>'+(len+i+1)+'</span>\u4F4D\u65C5\u5BA2</span>');sb.push('<div class=\'fl g6\'>');sb.push('<p class=\'p1 f16\'></p>');sb.push('<p class=\'p2 f12 f999\'></p>');sb.push('</div>');sb.push('<span class=\'arrow\'></span>');sb.push('</a>');sb.push('</li>')}conUl.append(sb.join(''))}else if(renshu<len){var lis=conUl.find('li');lis.each(function(k,v){if(k>=renshu){var oo=$(this);oo.remove()}})}};conBox.on('click','li',function(){var u=location.href.toLowerCase().replace('#','');var pid=_util.url.get('pid');var gdate=_util.url.get('gdate');var contactMan=$('#j_orderContact').find('input').eq(0).val();var contactPhone=$('#j_orderContact').find('input').eq(1).val();var fenshu=$('#j_fenshu').find('input').val();var renshu=$('#j_renshu').find('input').val();var ischina=$('#ischina').val();var tourids=_util.url.get('tourids');var sb=[];if(pid){sb.push('pid='+pid)}if(gdate){sb.push('gdate='+gdate)}if(fenshu){sb.push('fenshu='+fenshu)}if(renshu){sb.push('renshu='+renshu)}if(ischina){sb.push('ischina='+ischina)}if(contactMan){sb.push('contactman='+window.escape(contactMan))}if(contactPhone){sb.push('contactphone='+contactPhone)}if(tourids){sb.push('tourids='+tourids)}location.href='/touristList?'+sb.join('&')});nFen.find('span').on('click',function(){var o=$(this);var otxt=o.siblings('.s2');var otxtV=parseInt(otxt.val(),10);if(o.hasClass('s3')){if(otxtV<cn){otxt.val(otxtV+1);txtRen.val((otxtV+1)*fs)}else{_uzm.pop.toast('\u6700\u591A\u53EF\u9009\u62E9'+cn+'\u4EFD')}}else if(o.hasClass('s1')){if(otxtV<=1){return}if(otxtV<=cn){otxt.val(otxtV-1);txtRen.val((otxtV-1)*fs)}}_unitPriceEvent();_unitUserEventExt(txtRen.val())});nRen.find('span').on('click',function(){var o=$(this);var otxt=o.siblings('.s2');var otxtV=parseInt(otxt.val(),10);var otxtVN;var mo;if(o.hasClass('s3')){if(otxtV<fs*cn){otxt.val(otxtV+1);otxtVN=parseInt(otxt.val(),10);mo=otxtVN%fs;if(mo>0){txtFen.val(parseInt((otxtVN/fs).toString().split('.')[0],10)+1)}else if(mo===0){txtFen.val(otxtVN/fs)}}else{_uzm.pop.toast('\u6700\u591A\u53EF\u51FA\u884C\u4EBA\u6570\u4E3A'+fs*cn)}}else if(o.hasClass('s1')){if(otxtV>1){otxt.val(otxtV-1);otxtVN=parseInt(otxt.val(),10);mo=otxtVN%fs;if(mo>0){txtFen.val(parseInt((otxtVN/fs).toString().split('.')[0],10)+1)}else if(mo===0){txtFen.val(otxtVN/fs)}}}_unitPriceEvent();_unitUserEventExt(txtRen.val())})};temaiexports.tip=function(){$('#j_temaiUserTip').on('click',function(){var sHtml='<p>1.\u4E58\u5BA2\u59D3\u540D\u5FC5\u987B\u4E0E\u767B\u8BB0\u6240\u6301\u8BC1\u4EF6\u59D3\u540D\u4E00\u81F4\u3002</p><p>2.\u6301\u62A4\u7167\u767B\u673A\uFF0C\u5982\u4F7F\u7528\u4E2D\u6587\u59D3\u540D\uFF0C\u8BF7\u786E\u4FDD\u62A4\u7167\u4E0A\u6709\u76F8\u5E94\u7684\u4E2D\u6587\u59D3\u540D\u3002</p><p>3.\u6301\u62A4\u7167\u767B\u673A\u7684\u5916\u5BBE\uFF0C\u8BF7\u4EE5\u59D3\u5728\u524D\u540D\u5728\u540E\u7684\u65B9\u5F0F\u586B\u5199\uFF0C<BR>\u4F8B\uFF1AZhang\uFF08\u59D3\uFF09/San\uFF08\u540D\uFF09\uFF0C\u4E0D\u533A\u5206\u5927\u5C0F\u5199\u3002</p><p>4.\u82F1\u6587\u540D\u5B57\u7684\u957F\u5EA6\u4E0D\u53EF\u8D85\u8FC726\u4E2A\u5B57\u7B26\uFF0C\u5982\u540D\u5B57\u8FC7\u957F\u8BF7\u4F7F\u7528\u7F29\u5199\uFF0C\u4E58\u5BA2\u7684\u59D3\u6C0F\u4E0D\u80FD\u7F29\u5199\uFF0C\u540D\u53EF\u4EE5\u7F29\u5199\u3002</p><p>5.\u540D\u5B57\u4E2D\u6587\u542B\u751F\u50FB\u5B57\u53EF\u76F4\u63A5\u8F93\u5165\u62FC\u97F3\u4EE3\u66FF\uFF0C\u4F8B\uFF1A\u201C\u738B\u7109\u201D\u53EF\u8F93\u5165\u201C\u738Byan\u201D\u6216\u8005\u201C\u738B-yan\u201D\u3002</p>';_uzm.pop.cup(sHtml,5000)})};temaiexports.userModify=function(){$('#j_userTab').find('.users-list').find('li').on('longTap',function(){var o=$(this);var os=o.siblings('li');os.removeClass('on');o.addClass('on')});$(document).on('tap',function(e){var o='#j_userTab,#j_userTab *';if(!$(e.target).is(o)){$('#j_userTab').find('.users-list').find('li').removeClass('on')}});$('#j_userTab').find('.users-list').find('li').find('.round-box').on('click',function(){var o=$(this).find('.round');if(o.hasClass('on')){o.removeClass('on')}else{o.addClass('on')}});$('#j_userTab').find('.users-list').find('li').find('.icon-delete').on('click',function(){var o=$(this);var name=o.data('name');var ops=o.parents('li');var opsID=ops.attr('data-id');ops.remove();_uzm.pop.toast('\u8054\u7CFB\u4EBA'+name+'\u5DF2\u5220\u9664');$.ajax({url:'/touristsubmit?action=delete&tourid='+opsID,type:'GET',success:function success(){}});return false})};temaiexports.submitOrder=function(){$('#ordersubmit').on('click',function(){var cn=parseInt($('#cutNum').val(),10);var fen=parseInt($('#j_fenshu').find('input').val(),10);if(cn<fen){_uzm.pop.toast('\u4F59\u4F4D\u4E0D\u591F');return}var name=$('#username').val();if(!name){_uzm.pop.toast('\u8BF7\u586B\u5199\u8054\u7CFB\u4EBA');return}var usermobile=$('#usermobile').val();if(!usermobile){_uzm.pop.toast('\u8BF7\u586B\u5199\u8054\u7CFB\u624B\u673A');return}else{if(!_uzm.regexForm(usermobile)){_uzm.pop.toast('\u8BF7\u586B\u5199\u6B63\u786E\u7684\u624B\u673A\u53F7');return}}var bLK=true;var lis=$('#j_orderListUsers').find('li');lis.each(function(k,v){var o=$(this);var oname=$.trim(o.find('.g6').find('.p1').text());if(!oname){bLK=false;return false}});if(!bLK){_uzm.pop.toast('\u8BF7\u8865\u5145\u65C5\u5BA2\u4FE1\u606F');return}$('#temaiorder').submit()})};temaiexports.saveRoute=function(){var pid=$('#pid').val();$('.temai-focus').find('.star').on('click',function(){if(!_uzm.user.userid){location.href=_uzm.domain.u+'/mobile/login?reUrl='+location.href}var o=$(this);if(o.hasClass('star-on')){$.ajax({type:'GET',url:'http://m.uzai.com/delproduct-'+pid+'.html',dataType:'text',success:function success(msg){o.removeClass('star-on');_uzm.pop.toast('\u53D6\u6D88\u6536\u85CF\u6210\u529F')},error:function error(){}})}else{$.ajax({type:'GET',url:'http://m.uzai.com/addproduct-'+pid+'.html',dataType:'text',success:function success(msg){o.addClass('star-on');_uzm.pop.toast('\u6536\u85CF\u6210\u529F')},error:function error(){}})}})};$(function(){temaiexports.init()});
