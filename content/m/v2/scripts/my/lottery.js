'use strict';var lottery={};lottery.fixInit=function(lotteryPool){var myexports={};myexports.popLotterFail=function(){var boxFail=$('#j_popFailBox');_uzm.mask.show();var _unitClose=function _unitClose(){_uzm.mask.hide();boxFail.css({'opacity':0,'z-index':-1})};boxFail.css({'opacity':1,'z-index':1000}).find('.btn-anew').on('click',function(){_unitClose()});boxFail.find('.pop-close').on('click',function(){_unitClose()})};myexports.popLotterSuccess=function(key,url,prizeName){var boxSuccess=$('#j_popSuccessBox');boxSuccess.find('a').attr('href',url);boxSuccess.find('img').attr('src',key);boxSuccess.find('.yellow').text(prizeName);boxSuccess.find('.txt-wrap').find('.f15').text(prizeName);_uzm.mask.show();var _unitClose=function _unitClose(){_uzm.mask.hide();boxSuccess.css({'opacity':0,'z-index':-1})};boxSuccess.css({'opacity':1,'z-index':1000}).find('.btn-anew').on('click',function(){_unitClose()});boxSuccess.find('.pop-close').on('click',function(){_unitClose()})};myexports.popLotterSuccessCoupon=function(key,url,prizeName){var boxSuccess=$('#j_popSuccessBox');boxSuccess.find('a').attr('href',url);boxSuccess.find('img').attr('src',key);boxSuccess.find('.yellow').text(prizeName);boxSuccess.find('.txt-wrap').find('.f15').text(prizeName);_uzm.mask.show();var _unitClose=function _unitClose(){_uzm.mask.hide();boxSuccess.css({'opacity':0,'z-index':-1})};boxSuccess.css({'opacity':1,'z-index':1000}).find('.btn-confirm').on('click',function(){});boxSuccess.find('.pop-close').on('click',function(){_unitClose()})};myexports.fixInit=function(lotteryPool){$('.lotteryBtn').rotate({bind:{click:function click(){var oThis=$(this);var phoneId=$('#hphoneId').val();var source=$('#hsource').val();var version=$('#hversion').val();var userId=$('#huserId').val();if(oThis.hasClass('btn-off')){return}else{oThis.addClass('btn-off')}$.ajax({url:'/Sign/SignLuckySubmit/',type:'Post',dataType:'json',async:true,data:{version:version,phoneid:phoneId,source:source,userId:userId,ran:Math.random()},success:function success(data){var ds=parseInt(data.Status,10);if(ds===0){location.href=data.Url;return}else if(ds===-2){location.href=data.Url;return}else if(ds===-1){_uzm.pop.toast('U\u70B9\u4E0D\u8DB3');oThis.removeClass('btn-off');return}else{var STA=$('#SignTotalAmount');STA.text(parseInt(STA.text(),10)-20);myexports.init(parseInt(data.Position,10),lotteryPool,ds,data.Url,data.PrizePic,data.PrizeType,data.PrizeName)}}})}}})};myexports.init=function(key,lotteryPool,status,url,pic,prizeType,prizeName){var lotteryBtn=$('.lotteryBtn');var rotateNode=$('#j_lotterStar');var unitAngle=45;$('#j_popFailBox').css({'opacity':0,'z-index':-1});var timeOut=function timeOut(){rotateNode.rotate({angle:0,duration:10000,animateTo:6*360,callback:function callback(){if(status===2){if(prizeType===2){myexports.popLotterSuccessCoupon(pic,url)}else{myexports.popLotterSuccess(pic,url)}}else if(status===3){myexports.popLotterFail()}lotteryBtn.removeClass('btn-off')}})};var rotateFunc=function rotateFunc(awards,angle,text,status,url,pic,prizeType,prizeName){rotateNode.stopRotate();rotateNode.rotate({angle:0,duration:5000,animateTo:angle+4*360,callback:function callback(){if(status===2){if(prizeType===2){myexports.popLotterSuccessCoupon(pic,url,prizeName)}else{myexports.popLotterSuccess(pic,url,prizeName)}}else if(status===3){myexports.popLotterFail()}lotteryBtn.removeClass('btn-off')}})};if(parseInt(key,10)===0){timeOut()}else{rotateFunc(key,key*unitAngle,lotteryPool[key],status,url,pic,prizeType,prizeName)}};myexports.fixInit(lotteryPool)};
