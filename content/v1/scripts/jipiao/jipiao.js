/*! uzai - v0.1.11 - 2015-11 */function indexGetCity(){$("#j_indexCityList").find(".tejia-mod-hd").find("li").on("click",function(){var a=$(this),b=a.siblings("li"),c=a.index();b.removeClass("on"),a.addClass("on");var d=$("#j_indexCityList").find(".tejia-mod-bd").find(".item");d.hide();var e=d.eq(c);e.show(),null==e.find("li").get(0)&&$.ajax({url:"/content/v1/ashx/indexCityData.ashx",type:"GET",async:!1,dataType:"json",success:function(a){var b="{{#indexCityData}}<li><a href='{{url}}'><dl class='flight-item'><dt class='f14 b'>{{startCityName}}-{{endCityName}}</dt><dd class='clearfix'><span class='date fl'>{{startDate}}</span><i class='price orange f14 fr'>￥<em class='f24'>{{lowestPrice}}</em></i></dd></dl></a></li>{{/indexCityData}}",c=Mustache.render(b,a);e.html("<ul class='flight-list'>"+c+"</ul>")},error:function(){}})})}function SearchForm(){$("#j_submitForm").on("click",function(){if(""==$("#start-city").val())return $("#start-city").focus(),!1;if(""==$("#end-city").val())return $("#end-city").focus(),!1;if(""==$("#start-date").val())return $("#start-date").click(),!1;if($("#start-city").val()==$("#end-city").val())return $("#end-city").val(""),$("#end-city").focus(),!1;if(""!=$("#end-date").val()){if($("#start-date").val()==$("#end-date").val())return $("#end-date").val(""),$("#end-date").click(),!1;var a=parseInt($("#start-date").val().replace(/-/g,"")),b=parseInt($("#end-date").val().replace(/-/g,""));if(a>b)return $("#end-date").click(),!1}if($("#return-ticket").prop("checked")&&""==$("#end-date").val())return $("#end-date").val(""),$("#end-date").click(),!1;var c=$("#j_jpAllCityFilter").find(".li-none");if(c.length>=1){var d=c.attr("data-input");return $("#"+d).val(""),$("#"+d).focus(),!1}if(!$("#start-city-Code3").val())return $("#start-city").focus(),!1;if(!$("#end-city-Code3").val())return $("#end-city").focus(),!1;var e="<div id='LoadingCss' >正在为您搜索航班信息...</div>";$("#j_filterList").before(e),$("#j_filterList").remove(),$("#j_filterList_null").hide();var f=$("#start-city-Code3").val(),g=$("#end-city-Code3").val(),h=f+"-"+g,i="/SelectLoading/"+h+".html?start-date="+$("#start-date").val();""!=$("#end-date").val()&&(i+="&end-date="+$("#end-date").val()),$("#formFlight").attr("action",i),$("#formFlight").submit()})}function swapRoute(){$("#j_swapRoute").on("click",function(){var a=($(this),$("#start-city").val()),b=$("#end-city").val(),c=$("#start-city-Code3").val(),d=$("#end-city-Code3").val();$("#start-city").val(b),$("#end-city").val(a),$("#start-city-Code3").val(d),$("#end-city-Code3").val(c)}),$("#j_swapRouteType input:radio").on("change",function(){var a=$(this),b=$.trim(a.parents("label").text());"单程"===b?($("#j_endDate").find("label").addClass("f999"),$("#end-date").val("")):$("#j_endDate").find("label").removeClass("f999")}),$("#j_swapRouteType").find("input").eq(0).click()}function chooseRoute(){$("#start-city,#end-city").on("focus",function(){var a=$(this),b=a.parent("li"),c=a.parents(".froms-list"),d=(a.offset().left,a.offset().top,$("#j_hotCity"));c.find(".hot-city").remove(),b.append(d.find(".hot-city").clone(!0)),$(".hot-city .hot-city-close").on("click",function(){var a=$(this);a.parents(".hot-city").remove()}),tabSwitch(),b.find("a").not(".hot-city-close").on("click",function(){var b=$(this),c=b.parents(".hot-city"),d=c.siblings(".textbox");if(d.val($.trim(b.text())),$(".froms-list").find(".hot-city-close").click(),"start-city"===a.attr("id")){$("#start-city-Code3").val(b.attr("data-code"));var e=$("#end-city");if(""===e.val())return void $("#end-city").focus()}if("end-city"===a.attr("id")){if($("#end-city-Code3").val(b.attr("data-code")),!$("#start-city").val())return void $("#start-city").focus();var e=$("#start-date");if(!e.val())return void e.click()}$("#j_jpAllCityFilter").find(".li-none").remove()}),$("#j_jpAllCityFilter").hide(),$(".hot-city").show()})}function tabSwitch(){$(".froms-list .hot-city-bd .hd li").on("click",function(){var a=$(this),b=a.index(),c=(a.parent(".hd").siblings(".bd"),$(".froms-list .hot-city-bd .hd li")),d=$(".froms-list .hot-city-bd .bd .item");c.removeClass("on"),c.eq(b).addClass("on"),d.hide(),d.eq(b).show()})}function chooseCalendar(){$("#start-date,#end-date").datePicker({inline:!1,dateFormat:"yyyy-MM-dd",clickInput:!0,createButton:!1,showYearNavigation:!1,showMonthAfterYear:!0}).datePickerMultiMonth({numMonths:2}).bind("dpMonthChanged",function(a,b,c){}).bind("dateSelected",function(a,b,c,d){if("start-date"===a.currentTarget.id){var e=$("#j_swapRouteType").find("input:radio").eq(1);if(e.prop("checked")){var f=$("#end-date").val();""==f&&$("#end-date").focus()}}if("end-date"===a.currentTarget.id){var f=$("#end-date").val();$("#j_swapRouteType").find("input:radio").eq(1).click(),$("#j_searchTab .hd li").eq(1).click()}}).bind("dpDisplayed",function(a,b){}).bind("dpClosed",function(a,b){}).dpSetOffset(29,0),$(document).on("click",function(a){var b=".hot-city,.hot-city *,#start-city,#end-city";$(a.target).is(b)||$(".hot-city").hide()})}function initSearchForm(){$("#IsTogo").val("0"),$("#j_submitForm").click()}function changeRoute(){$("#j_searchTab li").on("click",function(){var a=$(this),b=a.parent(".hd");b.siblings(".bd"),a.index();b.find("li").removeClass("on"),a.addClass("on"),"单程"==$.trim(a.text())?($("#j_endDate").find("label").addClass("f999"),$("#end-date").val("")):$("#j_endDate").find("label").removeClass("f999")});var a=$("#end-date").val();a&&$("#IsOneWay").find("li").eq(1).click()}function listDrop(){$("#j_filtrateList").on("click",".flight-info .btn-book",function(){var a=$(this),b=a.parents("li"),c=b.siblings("li");c.removeClass("on"),b.hasClass("on")?(b.removeClass("on"),a.removeClass("on")):(b.addClass("on"),a.addClass("on"))})}function rechooseRoute(){$("#j_rechooseRoute").on("click",function(){initSearchForm()})}function winResize(){var a=function(){var a=$(window).width();1024>=a?($(".calendar-bar .week-items li").css({width:"113px"}),$("#j_weekItems").width("798px")):($(".calendar-bar .week-items li").css({width:"135px"}),$("#j_weekItems").width("950px"))};a()}function slideSchedule(){var a=1,b=10,c=7,d=$("#j_weekItems"),e=d.find("ul");$("#j_arrowBoxRight").on("click",function(){var f=function(){$.ajax({url:"/content/v1/ashx/RouteData.ashx",type:"GET",async:!1,dataType:"json",success:function(a){var b="{{#RouteData}}<li rel='{{alldate}}'><a><span>{{date}}</span><span class='ml10'>{{week}}</span></p><p class='price f18'>￥<em>{{price}}</em></p><p></li>{{/RouteData}}",c=Mustache.render(b,a);$("#j_weekItems").find("ul").append(c)},error:function(){}})},g=function(){if(!$("#j_arrowBoxRight").hasClass("off")){var f=d.width(),g=d.find("li").length,h=Math.ceil(g/c);e.is(":animated")||(a==h?$("#j_arrowBoxRight").addClass("off"):(e.animate({left:"-="+f},"slow"),a++,$("#j_arrowBoxLeft").removeClass("off"),a==b&&$("#j_arrowBoxRight").addClass("off")))}},h=d.find("li").length,i=Math.ceil(h/c);b>i&&i>=a&&f(),g()}),$("#j_arrowBoxLeft").on("click",function(){if(!$("#j_arrowBoxLeft").hasClass("off")){var b=d.width(),f=d.find("li").length;Math.ceil(f/c);e.is(":animated")||1==a||(e.animate({left:"+="+b},"slow"),a--,$("#j_arrowBoxRight").removeClass("off"),1==a&&$("#j_arrowBoxLeft").addClass("off"))}}),$("#j_weekItems").on("click","ul li",function(){var a=$(this);a.attr("rel")})}function filterSchedule(){$("#j_filtrateList .item-a,#j_filtrateList .item-h").on("click",function(){var a=$(this),b=a.attr("rel"),c="asc";$.trim(a.text());a.hasClass("on")?(a.removeClass("on"),a.addClass("off"),c="asc"):(a.removeClass("off"),a.addClass("on"),c="desc"),a.hasClass("on")&&a.hasClass("item-a")?a.attr("title","起降时间从早到晚"):a.hasClass("off")&&a.hasClass("item-a")&&a.attr("title","起降时间从晚到早"),a.hasClass("on")&&a.hasClass("item-h")?a.attr("title","价格从高到低"):a.hasClass("off")&&a.hasClass("item-h")&&a.attr("title","价格从低到高");var d=getFilteredParams();initSorter(d,b,c),a.siblings(".item").removeClass("on")})}function clearFilterTable(){$("#j_filtrateList").find(".item").removeClass("on")}function clearFilterBar(){$("#j_filterBar").find("input:checked").prop("checked",!1),$("#j_FilterChooseditems").find(".filter-chooseditems-box").empty(),$("#j_FilterChooseditems").hide()}function clearRouteList(){$("#j_filterList").empty(),$("#j_filterList_copy").empty()}function initSorter(a,b,c){var d="",e="",f="asc";if(a&&(d=a),b&&(e=b),c&&(f=c),null!=$("#j_filterList").get(0)){if(_util.check.isIE6)return;$("#j_filterList").uzSorter({sortBy:a,sortAscTag:b,sortAscKey:c,onInit:function(){},onCallback:function(){}})}}function viewCalender(){$("#j_viewCalender").on("click",function(){var a=($(this),$("#j_calendarWrap"));a.show(),a.datePicker({dateFormat:"yyyy-MM-dd",clickInput:!0,createButton:!1,showYearNavigation:!1,showMonthAfterYear:!0}).datePickerMultiMonth({numMonths:1,inline:!0}).bind("dpDisplayed",function(a,b){}).bind("dpMonthChanged",function(a,b,c){"2999"!=c&&loadCalendarData(""+c+"-"+parseInt(b+1))}).bind("dateSelected",function(a,b,c,d){var e=$("#j_calendarWrap");e.hide();b.asString()});var b=(new Date).getMonth()+1,c=(new Date).getFullYear();loadCalendarData(""+c+"-"+b)})}function loadCalendarData(a){var b=a;b&&$.ajax({url:"/content/v1/ashx/CalendarData.ashx?YearMonth="+b,type:"GET",cache:!0,dataType:"json",success:function(a){var b=a.CalendarList;$("#j_calendarWrap").find(".dp-applied").eq(0).each(function(a,c){var d=$(this),e=d.find(".current-month");e.each(function(a,c){var d=$(this),e=$.trim(d.text());if(!d.hasClass("disabled"))for(var f=0;f<b.length;f++){var g=b[f],h=(g.year,g.month,g.date),i=g.price;h==e&&d.append("<span class='pri'>￥"+i+"</span>")}})})},error:function(){}})}function blankFixEvents(){blankFix("j_viewCalenderWrap","j_calendarWrap"),blankFix("j_jpAllCityFilter","j_jpAllCityFilter")}function currentRoute(){var a=location.search.replace("#","").replace("?","");if(a&&a.indexOf("ydm")>-1){var b=a.split("=")[1];$("#j_weekItems").find("li").removeClass("on"),$("#j_weekItems").find("li[rel="+b+"]").addClass("on")}}function filterDrop(){$("#j_filterBar").find("li").mouseenter(function(){var a=$(this);a.find(".sel").addClass("sel-on"),a.find(".drop-ops").show()}).mouseleave(function(){var a=$(this);a.find(".sel").removeClass("sel-on"),a.find(".drop-ops").hide()}),$("#j_filterBar").on("change","input:checkbox",function(){unitFilterEvent()})}function unitFilterEvent(){var a=$("#j_FilterChooseditems").find(".filter-chooseditems-box");addFilterParams();var b=getFilteredParams();initSorter(b),null!=a.find("a").get(0)?$("#j_FilterChooseditems").show():$("#j_FilterChooseditems").hide()}function addFilterParams(){var a=$("#j_FilterChooseditems").find(".filter-chooseditems-box");a.empty(),$("#j_filterBar").find("li").each(function(b,c){var d=$(this);d.find("input:checkbox").each(function(b,c){var d=$(this);if(d.prop("checked")){var e=d.parents("dd");a.append("<a class='item'><span>"+$.trim(e.text())+"</span><b>&times</b></a>")}})})}function getFilteredParams(){var a=[];$("#j_filterBar").find("li").each(function(b,c){var d=$(this),e=[];d.find("input:checkbox").each(function(a,b){var c=$(this);if(c.prop("checked")){var d=c.parents("dd"),f=d.attr("rel");e.push(f)}}),e.length>0&&a.push(e.join("|"))});var b=a.join(",");return b}function handleChoosedItems(){var a=$("#j_FilterChooseditems");a.find("a.clear").on("click",function(){clearFilterBar(),unitFilterEvent()}),$("#j_FilterChooseditems").on("click",".item",function(){var a=$(this),b=a.find("span").text();a.remove(),$("#j_filterBar").find("dd").each(function(a,c){var d=$(this),e=$.trim(d.text());return e==b?(d.find("input:checkbox").prop("checked",!1),!1):void 0});var c=$("#j_FilterChooseditems").find(".filter-chooseditems-box").find(".item");return c.length<=0&&$("#j_FilterChooseditems").hide(),unitFilterEvent(),!1})}function ChooseToGo(a){try{var b=JSON.stringify(a);_uzw.cookie.del("uzwChooseFlightModel"),_uzw.cookie.set("uzwChooseFlightModel",b),$("#IsTogo").val("1");var c=$("#start-city-Code3").val(),d=$("#end-city-Code3").val(),e=c+"-"+d,f="/Select/"+e+".html?start-date="+$("#start-date").val();""!=$("#end-date").val()&&(f+="&end-date="+$("#end-date").val()),$("#formFlight").attr("action",f),$("#formFlight").submit()}catch(g){}}function LoginSignInPassBy(a){var b=$(a).parent().find("input").eq(1).val(),c=$(a).parent().find("input").eq(2).val(),d=$(a).parent().find("input").eq(3).val(),e=jQuery.parseJSON(c);if(null!=e){var f=e.aircodeField,g=e.cabinField,h=e.dstField,i=e.orgField,j=e.orgdateField,k=e.policyType9588Field,l={aircodeField:f,cabinField:g,dstField:h,orgField:i,orgdateField:j,policyType9588Field:k};$.ajax({url:"/ashx/GetStip.ashx",type:"post",async:!1,data:l,dataType:"json",success:function(a){e.BackTicketRegulations=a.BackTicketRegulations,e.ChangeRegulations=a.ChangeRegulations,e.EndorsementRegulations=a.EndorsementRegulations,c=JSON.stringify(e)},error:function(){}})}var m=jQuery.parseJSON(b);if(null!=m){var f=m.aircodeField,g=m.cabinField,h=m.dstField,i=m.orgField,j=m.orgdateField,k=m.policyType9588Field,l={aircodeField:f,cabinField:g,dstField:h,orgField:i,orgdateField:j,policyType9588Field:k};$.ajax({url:"/ashx/GetStip.ashx",type:"post",async:!1,data:l,dataType:"json",success:function(a){m.BackTicketRegulations=a.BackTicketRegulations,m.ChangeRegulations=a.ChangeRegulations,m.EndorsementRegulations=a.EndorsementRegulations,b=JSON.stringify(m)},error:function(){}})}var n="";null!=$.trim(c)&&void 0!=$.trim(c)&&""!=$.trim(c)&&"null"!=$.trim(c)&&"undefined"!=$.trim(c)&&(n="["+c),null!=$.trim(b)&&void 0!=$.trim(b)&&""!=$.trim(b)&&"null"!=b&&"undefined"!=b&&(""==n?n=b:n+=","+b+"]"),$("#FlightListPost").val(n),$("#IsOneWayPost").val(d),_uzw.user.userid?BookimgSubmit():editWidget(_uzw.domain.u+"/QuickLogin?actionName=BookimgSubmit")}function editWidget(a){window.scrollTo(0,0);var b=document.documentElement.clientWidth+document.documentElement.scrollLeft,c=document.documentElement.clientHeight+document.documentElement.scrollTop,d=document.createElement("div");d.style.zIndex=999,d.id="layer",d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.height=document.documentElement.scrollHeight+"px",d.style.width=b+"px",d.style.backgroundColor="black",d.style.opacity=".3",d.style.filter+="progid:DXImageTransform.Microsoft.Alpha(opacity=30)",document.body.style.position="static",document.body.appendChild(d);var e={height:250,width:640},f=document.createElement("iframe");f.name="Widget Editor",f.id="WidgetEditor",f.scrolling="no",f.src=a,f.style.height=e.height+"px",f.style.width=e.width+"px",f.style.position="absolute",f.style.zIndex=1e3,f.style.border="0px",f.frameBorder="0px",f.marginwidth="0",f.marginheight="0",f.style.top=(c+document.documentElement.scrollTop)/2-e.height/2+"px",f.style.left=b/2-e.width/2+"px",document.body.appendChild(f)}function closeEditor(){var a=document.getElementById("WidgetEditor"),b=document.getElementById("layer");document.body.removeChild(a),document.body.removeChild(b),document.body.style.position=""}function GetStip(a){if(""==jQuery.trim($(a).parent("div").find(".g10").find("td").eq(0).text())){var b=$(a).parent("div").find("#aircodeField").val(),c=$(a).parent("div").find("#cabinField").val(),d=$(a).parent("div").find("#dstField").val(),e=$(a).parent("div").find("#orgField").val(),f=$(a).parent("div").find("#orgdateField").val(),g=$(a).parent("div").find("#policyType9588Field").val(),h={aircodeField:b,cabinField:c,dstField:d,orgField:e,orgdateField:f,policyType9588Field:g};$.ajax({url:"/ashx/GetStip.ashx",type:"post",async:!1,data:h,dataType:"json",success:function(b){$(a).parent("div").find(".g10").find("td").eq(0).text(jQuery.trim(b.BackTicketRegulations)),$(a).parent("div").find(".g10").find("td").eq(1).text(jQuery.trim(b.ChangeRegulations)),$(a).parent("div").find(".g10").find("td").eq(2).text(jQuery.trim(b.EndorsementRegulations))},error:function(){}})}}function comFilter(){var a=[],b=[];a=SCityArry.concat(ACityArry,BCityArry,CCityArry,DCityArry,ECityArry,FCityArry,GCityArry,HCityArry,JCityArry,KCityArry,LCityArry,MCityArry,NCityArry,PCityArry,QCityArry,RCityArry,RCityArry,TCityArry,WCityArry,XCityArry,YCityArry,ZCityArry);var c=function(a){if(a)for(var c=0;c<a.length;c++){var d=a[c];b.push({name:d.name,nameCN:d.nameCN,code:d.code,nameAbb:d.nameAbb})}};c(a);var d=function(){var a=$("#j_jpAllCityFilter");if(null==a.get(0)){var c="{{#.}}<li data-code='{{code}}'><span class='s0 hide'>{{nameAbb}}</span><span class='s1'>{{nameCN}}</span><span class='s2'>{{name}}</span></li>{{/.}}",d=Mustache.render(c,b);$("body").append("<ul id='j_jpAllCityFilter'>"+d+"</ul>")}$("#j_jpAllCityFilter").find("li").on("mouseenter",function(){var a=$(this);$("#j_jpAllCityFilter").find("li").removeClass("on"),a.addClass("on")})};d();var e=function(a){var b=$.trim(a.val().toUpperCase());if(!b)return a.focus(),void $("#j_jpAllCityFilter").hide();var c=a.offset().top,d=a.offset().left,e=a.height();$("#j_jpAllCityFilter").css({left:d,top:c+e}).show(),$("#j_jpAllCityFilter").find(".li-none").remove(),$("#j_jpAllCityFilter").find("li").each(function(a,c){var d=$(this),e=d.text().toUpperCase();d.find("s0").text();e.indexOf(b)>-1?d.show():d.hide()});var f=$("#j_jpAllCityFilter").find("li:visible");if(f.length>15&&f.each(function(a,b){var c=$(this);a>=15&&c.hide()}),$("#j_jpAllCityFilter").find("li").off("click"),$("#j_jpAllCityFilter").find("li:visible").on("click",function(){var b=$(this),c=b.find(".s1").text(),d=b.attr("data-code");a.val(c),"start-city"==a.attr("id")?($("#start-city-Code3").val(d),$("#start-city").blur(),$("#end-city").focus()):"end-city"==a.attr("id")&&($("#end-city-Code3").val(d),$("#end-city").blur(),$("#start-date").click()),$("#j_jpAllCityFilter").hide(),$("#j_jpAllCityFilter").find(".on").removeClass("on")}),$("#j_jpAllCityFilter").find("li:visible").not(".li-none").length<=0){var g="start-city"==a.attr("id")?"start-city":"end-city";$("#j_jpAllCityFilter").append("<li data-input='"+g+"' class='li-none'>找不到'"+b+"'</li>")}else $("#j_jpAllCityFilter").find(".li-none").remove()};$("#start-city,#end-city").on("keydown",function(){var a=$(this);a.siblings(".hot-city").remove()});var f=function(a){var b=a.val(),c=$("#j_jpAllCityFilter").find("li").not(".li-none");c.each(function(){var c=$(this),d=c.find(".s1");return b==d.text()?(a.next("input").val(c.attr("data-code")),!1):void 0})};$("#start-city,#end-city").on("blur",function(a){var b=$(this);b.next("input").val(""),f(b)}),$("#start-city,#end-city").on("keyup",function(a){var b=$(this);b.val($.trim(b.val())),f(b),e(b)});var g=function(a,b){var c=$("#j_jpAllCityFilter").find("li:visible");if("down"===a)if(c.filter(".on").length>0){var d=c.filter(".on").nextAll("li:visible").eq(0);$("#j_jpAllCityFilter").find("li").removeClass("on"),null!=d.get(0)?d.addClass("on"):c.eq(0).addClass("on")}else c.removeClass("on"),c.eq(0).addClass("on");else if("up"===a)if(c.filter(".on").length>0){var e=c.filter(".on").prevAll("li:visible").eq(0);$("#j_jpAllCityFilter").find("li").removeClass("on"),null!=e.get(0)?e.addClass("on"):c.filter(":visible").last("li").addClass("on")}else c.removeClass("on"),c.filter(":visible").last("li").addClass("on");else"enter"===a&&$("#j_jpAllCityFilter").find(".on").click()};$("#start-city,#end-city").on("keydown",function(a){var b=$(this);b.val($.trim(b.val()));var c=a.keyCode?a.keyCode:a.which;if("9"==c||"16"==c||"17"==c||"18"==c)return void $(".hot-city").hide();if("38"==c)g("up",b);else if("40"==c)g("down",b);else if("13"==c)return g("enter",b),!1})}function popMod(a,b){var c=$("#"+a);null==c.get(0)&&(c=$("."+a));var d=c.parent();d.find(".mask").height(document.body.clientHeight),d.show().siblings(".pop-mod").hide(),c.show(),$(window).bind("scroll",function(){fixIe6(a,b)})}function fixIe6(a,b){var c=$("#"+a);null==c.get(0)&&(c=$("."+a)),window.XMLHttpRequest||c.css("top",$(document).scrollTop()+b)}$(function(){indexGetCity(),SearchForm(),swapRoute(),chooseRoute(),chooseCalendar(),changeRoute(),listDrop(),rechooseRoute(),winResize(),clearFilterBar(),filterSchedule(),filterDrop(),comFilter(),handleChoosedItems(),viewCalender(),slideSchedule(),blankFixEvents(),currentRoute()});