/*! uzai - v0.1.11 - 2017 */

/*!
 * 猜你喜欢
 * v: 0.0.1
 * d: 2016-4-29
*/
function guessLike(a,b,c,d){var e,f,g,h,i=function(a){var b=a.split(","),c=[];if(d=d||2,b&&b.length)for(var e in b)c.length<d&&c.push(b[e].substr(5));return c.join(",")},j=function(){var a=e.find(".gl-item").length;if(a>3)e.find(".no-more").remove();else{var b=e.find(".no-more");b.get(0)||e.find(".guess-like-items").after('<p class="no-more tc f16 yahei lh2 pb10">今天为您推荐的旅行线路已看完，请明天再来看看吧</p>')}4>=a?e.find(".btn-change").addClass("btn-off"):e.find(".btn-change").removeClass("btn-off")};"undefined"==typeof c&&(c={width:310,height:230}),e=$("#"+a),e.get(0)||(e=$("."+a)),e.get(0)&&(f="",f+="<div id='j_guessLikeBox' class='guess-like-box slice-mod mt10 box-fix'>",f+="<h2 class='mod-hd clearfix'><span class='hd-main fl'><i class='hd-icon vm'></i><em class='hd-cont red f16 vm'>猜你喜欢</em></span><span class='btn-change pointer blue f16 fr'><i class='icon-refresh mr5 vm icon-common-main png'></i><em class='vm'>换一批</em></span></h2>",f+="<div class='mod-bd'><div class='guess-like-items clearfix'></div></div>",f+="</div>",e.html(f),h=e.find(".mod-hd").find(".hd-main"),_uzw.user.userid?h.find(".login-tips").get(0)&&h.find(".login-tips").detach():h.find(".login-tips").get(0)||h.append('<span class="login-tips f999 f14 ml10 vm">为了更精准的给您推荐线路，建议您先<a href="https:'+_uzw.domain.u+'/reguser" class="btn-login blue">登录</a>。</span>'),g=function(){$.ajax({type:"GET",url:_uzw.domain.wapi+"/api/UzaiInterest/GetUserInterest",data:{userId:_uzw.user.userid||0,city:_ug.cityID,number:b||30,w:c.width,h:c.height},dataType:"jsonp",beforeSend:function(){e.find(".no-more").remove(),e.find(".guess-like-items").empty().addClass("guess-like-items-ing")},success:function(a){var b="uzwGuessLikeOfDislike",c=_uzw.cookie.get(b),d=[],f=0;c&&(d=c.split("|"),f=d.length),a&&a.length?setTimeout(function(){var c="",g=4;$.each(a,function(a,b){var e,h,j=b.ProductURL+"?retype=ItemHistory",k=b.ProductId;for(e=0,h=!0;f>e;e++)d[e]==k&&(h=!1,g++);h&&(c+="<a href='"+j+"' class='gl-item "+(a>=g?"hide":"")+" ' data-pid='"+k+"' target='_blank'>",c+="<p class='item-pic'>",c+="<span class='dislike' data-fromType='"+b.FromType+"'><i class='icon-dislike mr5 vm icon-common-main png'></i>不喜欢</span>",c+="<img  src='"+b.PicUrl.replace("http://","//")+"' alt='' class='g10 block'>",c+="</p>",c+="<dl class='item-cont'>",c+="<dt class='item-hd f14' title='"+b.ProductName+"'>"+b.ProductName+"</dt>",c+="<dd class='item-ft clearfix'>",c+="<span class='item-date f666 fl mt5'>班期："+i(b.GoDate)+"</span>",c+="<span class='item-price f14 fr'><i class='red f16'>￥<em>"+b.MaxPrice+"</em></i>起</span>",c+="</dd>",c+="</dl>",c+="</a>")}),c&&(e.find(".guess-like-items").html(c),e.find(".dislike").on("click",function(){var a,c=$(this),f=c.parents(".gl-item"),g=f.attr("data-pid"),h=f.nextAll(".gl-item:hidden").eq(0),i=function(){f.css({width:"0",height:"0","margin-left":"0","margin-right":"0",opacity:"0"}),setTimeout(function(){f.remove(),e.find(".gl-item:visible").get(0)?h.show():e.find(".gl-item:hidden").each(function(a){var b=$(this);4>a&&b.show()}),j()},500)};return c.hasClass("btn-off")?void 0:(_uzw.user.userid?(a={userId:_uzw.user.userid,city:0,channel:1,type:7,productIds:g,fromtype:c.attr("data-fromType")},$.ajax({type:"post",url:_uzw.domain.wapi+"/api/UzaiInterest/InsertUserInterest",data:a,dataType:"jsonp",success:function(a){a>0?i():alert("操作失败！")},error:function(){}})):(i(),d.push(g),_uzw.cookie.set(b,d.join("|"),1)),!1)})),j()},800):j()},complete:function(){e.find(".guess-like-items").removeClass("guess-like-items-ing")}})},g(),e.find(".btn-change").on("click",function(){var a=$(this),b=e.find(".gl-item"),c=b.length,d=c%4===0?Math.floor(c/4):Math.floor(c/4)+1,f=parseInt(a.attr("data-index"))||1,g=f>=d?1:f+1,h=4*(g-1),i=4*g;b.hide(),e.find(".gl-item").filter(function(a){return a>=h&&i>a}).show(),a.attr("data-index",g+"")}))}_util.file.load(("dev"===_env?"":_uzw.domain.cdnRandom())+"/content/v1/styles/com/guesslike.css");
//# sourceMappingURL=/sourcemaps/content/v1/scripts/com/guesslike.js.map